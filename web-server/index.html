<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Flashcards - Spaced Repetition</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            overflow-x: hidden;
            -webkit-tap-highlight-color: transparent;
        }
        .header { padding: 15px; text-align: center; color: white; position: relative; }
        .header h1 { font-size: 1.5rem; margin-bottom: 10px; text-shadow: 0 2px 4px rgba(0,0,0,0.2); }
        .mode-toggle { display: flex; justify-content: center; gap: 10px; margin-bottom: 10px; }
        .mode-btn { padding: 8px 16px; border: 2px solid white; background: transparent; color: white; border-radius: 20px; cursor: pointer; font-size: 14px; transition: all 0.3s ease; }
        .mode-btn.active { background: white; color: #667eea; }
        .stats-bar { display: flex; justify-content: center; gap: 20px; padding: 10px; color: white; font-size: 14px; }
        .stat-item { text-align: center; }
        .stat-value { font-size: 1.5rem; font-weight: bold; display: block; }
        .stat-label { font-size: 0.75rem; opacity: 0.9; }
        .deck-selector { padding: 10px 15px; font-size: 16px; border: none; border-radius: 25px; background: rgba(255, 255, 255, 0.9); color: #333; cursor: pointer; outline: none; box-shadow: 0 4px 6px rgba(0,0,0,0.1); min-width: 200px; -webkit-appearance: none; appearance: none; background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e"); background-repeat: no-repeat; background-position: right 12px center; background-size: 16px; }
        .progress-container { padding: 10px 20px; }
        .progress-bar { height: 8px; background: rgba(255, 255, 255, 0.3); border-radius: 4px; overflow: hidden; box-shadow: inset 0 2px 4px rgba(0,0,0,0.1); }
        .progress-fill { height: 100%; background: linear-gradient(90deg, #f093fb 0%, #f5576c 100%); transition: width 0.3s ease; border-radius: 4px; }
        .progress-text { text-align: center; color: white; font-size: 14px; margin-top: 8px; text-shadow: 0 1px 2px rgba(0,0,0,0.2); }
        .card-container { flex: 1; display: flex; justify-content: center; align-items: center; padding: 20px; perspective: 1000px; touch-action: pan-y; }
        .card { width: 100%; max-width: 400px; min-height: 300px; position: relative; transform-style: preserve-3d; transition: transform 0.6s cubic-bezier(0.4, 0.0, 0.2, 1), margin 0.3s ease; cursor: pointer; }
        .card.flipped { transform: rotateY(180deg); }
        .card-face { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; border-radius: 20px; padding: 30px; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; box-shadow: 0 20px 40px rgba(0,0,0,0.2); background: white; }
        .card-front { background: linear-gradient(135deg, #f5f7fa 0%, #e4e8f0 100%); color: #333; }
        .card-back { background: linear-gradient(135deg, #e0c3fc 0%, #8ec5fc 100%); color: #333; transform: rotateY(180deg); }
        .card-label { font-size: 12px; text-transform: uppercase; letter-spacing: 2px; margin-bottom: 15px; opacity: 0.7; font-weight: 600; }
        .card-content { font-size: 1.1rem; line-height: 1.6; word-wrap: break-word; overflow-wrap: break-word; max-width: 100%; }
        .card-content strong { color: #764ba2; }
        .card-content code { background: #f4f4f4; padding: 2px 6px; border-radius: 4px; font-family: 'Courier New', monospace; font-size: 0.9em; }
        .difficulty-buttons { display: none; justify-content: center; gap: 10px; padding: 15px 20px; flex-wrap: wrap; }
        .difficulty-buttons.visible { display: flex; }
        .diff-btn { padding: 12px 20px; border: none; border-radius: 25px; font-size: 14px; font-weight: bold; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(0,0,0,0.2); min-width: 80px; }
        .diff-btn:hover { transform: scale(1.05); }
        .diff-btn-again { background: linear-gradient(135deg, #ff6b6b 0%, #ee5a5a 100%); color: white; }
        .diff-btn-hard { background: linear-gradient(135deg, #feca57 0%, #ff9f43 100%); color: #333; }
        .diff-btn-good { background: linear-gradient(135deg, #48dbfb 0%, #0abde3 100%); color: white; }
        .diff-btn-easy { background: linear-gradient(135deg, #1dd1a1 0%, #10ac84 100%); color: white; }
        .diff-btn .interval { display: block; font-size: 10px; font-weight: normal; opacity: 0.9; margin-top: 2px; }
        .controls { padding: 20px; display: flex; justify-content: center; gap: 20px; }
        .controls.hidden { display: none; }
        .btn { width: 60px; height: 60px; border: none; border-radius: 50%; font-size: 24px; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(0,0,0,0.2); display: flex; align-items: center; justify-content: center; -webkit-tap-highlight-color: transparent; }
        .btn-prev { background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); color: white; }
        .btn-next { background: linear-gradient(135deg, #30cfd0 0%, #330867 100%); color: white; }
        .instructions { text-align: center; color: rgba(255, 255, 255, 0.8); padding: 10px 20px 20px; font-size: 14px; }
        .instructions.hidden { display: none; }
        .completion-message { text-align: center; color: white; padding: 40px 20px; }
        .completion-message h2 { font-size: 2rem; margin-bottom: 15px; }
        .completion-message p { font-size: 1.1rem; margin-bottom: 20px; opacity: 0.9; }
        .completion-message .btn-restart { padding: 15px 30px; background: white; color: #667eea; border: none; border-radius: 25px; font-size: 16px; font-weight: bold; cursor: pointer; transition: all 0.3s ease; }
        .completion-message .btn-restart:hover { transform: scale(1.05); }
        .reset-btn { position: absolute; top: 15px; left: 15px; padding: 8px 12px; background: rgba(255,255,255,0.2); border: 1px solid white; color: white; border-radius: 15px; font-size: 12px; cursor: pointer; transition: all 0.3s ease; }
        .reset-btn:hover { background: rgba(255,255,255,0.3); }
        .loading { display: flex; justify-content: center; align-items: center; height: 100vh; color: white; font-size: 1.2rem; }
        @media (max-width: 480px) {
            .card { min-height: 250px; }
            .card-content { font-size: 1rem; }
            .header h1 { font-size: 1.3rem; }
            .diff-btn { padding: 10px 15px; font-size: 12px; min-width: 70px; }
            .stats-bar { gap: 15px; font-size: 12px; }
            .stat-value { font-size: 1.2rem; }
        }
    </style>
</head>
<body>
    <div class="loading" id="loading">Loading flashcards...</div>
    
    <div class="header" id="header" style="display: none;">
        <button class="reset-btn" id="resetBtn" onclick="resetProgress()">Reset Progress</button>
        <h1>Study Flashcards</h1>
        
        <div class="mode-toggle">
            <button class="mode-btn active" id="reviewModeBtn" onclick="setMode('review')">Review (SRS)</button>
            <button class="mode-btn" id="studyModeBtn" onclick="setMode('study')">Study All</button>
        </div>

        <div class="stats-bar" id="statsBar">
            <div class="stat-item">
                <span class="stat-value" id="dueCount">0</span>
                <span class="stat-label">Due Now</span>
            </div>
            <div class="stat-item">
                <span class="stat-value" id="newCount">0</span>
                <span class="stat-label">New</span>
            </div>
            <div class="stat-item">
                <span class="stat-value" id="learnedCount">0</span>
                <span class="stat-label">Learned</span>
            </div>
        </div>

        <select class="deck-selector" id="deckSelector">
            <option value="sql-data-engineering">SQL Data Engineering</option>
            <option value="sql-server-dba">SQL Server DBA</option>
            <option value="tsql-keys">T-SQL Keys</option>
            <option value="music-theory">Music Theory</option>
            <option value="us-civil-war">US Civil War History</option>
        </select>
    </div>

    <div class="progress-container" id="progressContainer" style="display: none;">
        <div class="progress-bar">
            <div class="progress-fill" id="progressFill" style="width: 0%"></div>
        </div>
        <div class="progress-text" id="progressText">Card 0 of 0</div>
    </div>

    <div class="card-container" id="cardContainer" style="display: none;">
        <div class="card" id="card">
            <div class="card-face card-front">
                <div class="card-label">Question</div>
                <div class="card-content" id="question"></div>
            </div>
            <div class="card-face card-back">
                <div class="card-label">Answer</div>
                <div class="card-content" id="answer"></div>
            </div>
        </div>
    </div>

    <div class="completion-message" id="completionMessage" style="display: none;">
        <h2>ðŸŽ‰ All Caught Up!</h2>
        <p>You've reviewed all due cards for this deck.</p>
        <p id="nextReviewInfo"></p>
        <button class="btn-restart" onclick="loadDeck(currentDeckKey)">Continue Studying</button>
    </div>

    <div class="controls" id="controls">
        <button class="btn btn-prev" id="prevBtn">&larr;</button>
        <button class="btn btn-next" id="nextBtn">&rarr;</button>
    </div>

    <div class="difficulty-buttons" id="difficultyButtons">
        <button class="diff-btn diff-btn-again" onclick="rateCard('again')">Again<span class="interval">&lt; 1m</span></button>
        <button class="diff-btn diff-btn-hard" onclick="rateCard('hard')">Hard<span class="interval" id="hardInterval">1d</span></button>
        <button class="diff-btn diff-btn-good" onclick="rateCard('good')">Good<span class="interval" id="goodInterval">2d</span></button>
        <button class="diff-btn diff-btn-easy" onclick="rateCard('easy')">Easy<span class="interval" id="easyInterval">4d</span></button>
    </div>

    <div class="instructions" id="instructions">Tap card to flip â€¢ Swipe to navigate</div>

    <script>
        const decks = {
            'sql-data-engineering': [
                { q: 'What is a **Data Warehouse**?', a: 'A central repository of integrated data from multiple sources, optimized for reporting and analysis.' },
                { q: 'What is **ETL**?', a: 'Extract, Transform, Load - extracting data, transforming it, and loading into target database.' },
                { q: 'What is **Dimensional Modeling**?', a: 'Design technique using facts (metrics) and dimensions (context) for data warehousing.' },
                { q: 'What is a **Star Schema**?', a: 'Dimensional model with central fact table surrounded by denormalized dimension tables.' },
                { q: 'What is a **Fact Table**?', a: 'Contains quantitative data (facts/measurements) for analysis.' },
                { q: 'What is **CDC**?', a: 'Change Data Capture - identifies and captures changes made to data.' }
            ],
            'sql-server-dba': [
                { q: 'What are **SQL Server Recovery Models**?', a: 'Full, Bulk-Logged, and Simple.' },
                { q: 'What is a **Deadlock**?', a: 'When two transactions block each other by holding locks on resources.' },
                { q: 'What is **Always On**?', a: 'Enterprise HA/DR solution supporting multiple secondary replicas.' }
            ],
            'tsql-keys': [
                { q: 'What is a **Primary Key**?', a: 'Uniquely identifies each row. Cannot contain NULL values.' },
                { q: 'What is a **Foreign Key**?', a: 'Establishes a link between two tables ensuring referential integrity.' },
                { q: 'What is **Referential Integrity**?', a: 'Ensures relationships between tables remain consistent.' }
            ],
            'music-theory': [
                { q: 'What are the 12 notes in Western music?', a: 'C, C#/Db, D, D#/Eb, E, F, F#/Gb, G, G#/Ab, A, A#/Bb, B' },
                { q: 'What is the formula for a major scale?', a: 'Whole-Whole-Half-Whole-Whole-Whole-Half (W-W-H-W-W-W-H)' },
                { q: 'What notes make up a C major triad?', a: 'C - E - G' }
            ],
            'us-civil-war': [
                { q: 'When did the Civil War begin?', a: 'April 12, 1861' },
                { q: 'Who was the Union President?', a: 'Abraham Lincoln' },
                { q: 'What was the Emancipation Proclamation?', a: 'Issued January 1, 1863, declared enslaved people in Confederate territory free.' }
            ]
        };

        let currentDeckKey = '', currentDeck = [], currentIndex = 0, isFlipped = false, studyMode = 'review', cardData = {};

        function loadCardData() {
            const saved = localStorage.getItem('flashcardData');
            if (saved) cardData = JSON.parse(saved);
        }

        function saveCardData() {
            localStorage.setItem('flashcardData', JSON.stringify(cardData));
        }

        function initDeckData(deckKey) {
            if (!cardData[deckKey]) cardData[deckKey] = {};
            decks[deckKey].forEach((card, index) => {
                if (!cardData[deckKey][index]) {
                    cardData[deckKey][index] = { ease: 2.5, interval: 0, repetitions: 0, dueDate: null, lastReviewed: null };
                }
            });
            saveCardData();
        }

        function getDueCards(deckKey) {
            const now = new Date().getTime();
            const dueCards = [], newCards = [];
            decks[deckKey].forEach((card, index) => {
                const data = cardData[deckKey][index];
                if (data.dueDate === null) newCards.push({ card: {question: card.q, answer: card.a}, index, data });
                else if (data.dueDate <= now) dueCards.push({ card: {question: card.q, answer: card.a}, index, data });
            });
            return { dueCards, newCards };
        }

        function calculateInterval(data, rating) {
            if (rating === 'again') return { interval: 60, ease: Math.max(1.3, data.ease - 0.2), repetitions: 0 };
            if (rating === 'hard') return { interval: data.repetitions === 0 ? 86400 : data.interval * 1.2, ease: Math.max(1.3, data.ease - 0.15), repetitions: data.repetitions + 1 };
            if (rating === 'good') {
                let interval;
                if (data.repetitions === 0) interval = 86400 * 2;
                else if (data.repetitions === 1) interval = 86400 * 6;
                else interval = data.interval * 2.5;
                return { interval, ease: data.ease, repetitions: data.repetitions + 1 };
            }
            if (rating === 'easy') return { interval: data.repetitions === 0 ? 86400 * 4 : data.interval * 4, ease: data.ease + 0.15, repetitions: data.repetitions + 1 };
        }

        function formatInterval(seconds) {
            if (seconds < 60) return '< 1m';
            if (seconds < 3600) return Math.round(seconds / 60) + 'm';
            if (seconds < 86400) return Math.round(seconds / 3600) + 'h';
            return Math.round(seconds / 86400) + 'd';
        }

        function updateIntervalDisplay() {
            if (currentDeck.length === 0) return;
            const data = currentDeck[currentIndex].data;
            document.querySelector('.diff-btn-again .interval').textContent = '< 1m';
            document.getElementById('hardInterval').textContent = formatInterval(calculateInterval(data, 'hard').interval);
            document.getElementById('goodInterval').textContent = formatInterval(calculateInterval(data, 'good').interval);
            document.getElementById('easyInterval').textContent = formatInterval(calculateInterval(data, 'easy').interval);
        }

        function rateCard(rating) {
            if (currentDeck.length === 0) return;
            const currentCard = currentDeck[currentIndex];
            const result = calculateInterval(currentCard.data, rating);
            
            cardData[currentDeckKey][currentCard.index] = {
                ease: result.ease, interval: result.interval, repetitions: result.repetitions,
                dueDate: new Date().getTime() + (result.interval * 1000), lastReviewed: new Date().getTime()
            };
            saveCardData();
            
            if (studyMode === 'review') {
                currentDeck.splice(currentIndex, 1);
                if (currentIndex >= currentDeck.length) currentIndex = Math.max(0, currentDeck.length - 1);
            } else {
                currentIndex++;
                if (currentIndex >= currentDeck.length) currentIndex = 0;
            }
            
            isFlipped = false;
            document.getElementById('card').classList.remove('flipped');
            document.getElementById('difficultyButtons').classList.remove('visible');
            document.getElementById('controls').classList.remove('hidden');
            document.getElementById('instructions').classList.remove('hidden');
            
            updateStats();
            if (currentDeck.length === 0) showCompletion();
            else renderCard();
        }

        function updateStats() {
            const { dueCards, newCards } = getDueCards(currentDeckKey);
            const learned = Object.values(cardData[currentDeckKey] || {}).filter(d => d.repetitions > 0).length;
            document.getElementById('dueCount').textContent = dueCards.length;
            document.getElementById('newCount').textContent = newCards.length;
            document.getElementById('learnedCount').textContent = learned;
        }

        function setMode(mode) {
            studyMode = mode;
            document.getElementById('reviewModeBtn').classList.toggle('active', mode === 'review');
            document.getElementById('studyModeBtn').classList.toggle('active', mode === 'study');
            loadDeck(currentDeckKey);
        }

        function showCompletion() {
            document.getElementById('cardContainer').style.display = 'none';
            document.getElementById('controls').style.display = 'none';
            document.getElementById('difficultyButtons').style.display = 'none';
            document.getElementById('instructions').style.display = 'none';
            document.getElementById('progressContainer').style.display = 'none';
            document.getElementById('completionMessage').style.display = 'block';
            
            const now = new Date().getTime();
            let nextDue = Infinity;
            Object.values(cardData[currentDeckKey] || {}).forEach(data => {
                if (data.dueDate && data.dueDate > now && data.dueDate < nextDue) nextDue = data.dueDate;
            });
            
            if (nextDue !== Infinity) {
                const diff = Math.ceil((nextDue - now) / (1000 * 60 * 60));
                document.getElementById('nextReviewInfo').textContent = diff < 24 ? `Next review in ${diff} hours` : `Next review in ${Math.ceil(diff / 24)} days`;
            } else {
                document.getElementById('nextReviewInfo').textContent = 'All cards learned!';
            }
        }

        function loadDeck(deckKey) {
            if (!deckKey) return;
            currentDeckKey = deckKey;
            initDeckData(deckKey);
            
            if (studyMode === 'review') {
                const { dueCards, newCards } = getDueCards(deckKey);
                currentDeck = [...dueCards, ...newCards.slice(0, 5)];
            } else {
                currentDeck = decks[deckKey].map((card, index) => ({ card: {question: card.q, answer: card.a}, index, data: cardData[deckKey][index] }));
            }
            
            currentIndex = 0; isFlipped = false;
            document.getElementById('card').classList.remove('flipped');
            document.getElementById('difficultyButtons').classList.remove('visible');
            document.getElementById('completionMessage').style.display = 'none';
            document.getElementById('cardContainer').style.display = 'flex';
            document.getElementById('controls').style.display = 'flex';
            document.getElementById('instructions').style.display = 'block';
            document.getElementById('progressContainer').style.display = 'block';
            
            updateStats();
            if (currentDeck.length === 0) showCompletion();
            else renderCard();
        }

        function renderCard() {
            if (currentDeck.length === 0) return;
            const current = currentDeck[currentIndex];
            document.getElementById('question').innerHTML = current.card.question.replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>').replace(/`(.+?)`/g, '<code>$1</code>');
            document.getElementById('answer').innerHTML = current.card.answer.replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>').replace(/`(.+?)`/g, '<code>$1</code>');
            document.getElementById('progressText').textContent = `Card ${currentIndex + 1} of ${currentDeck.length}`;
            document.getElementById('progressFill').style.width = `${((currentIndex + 1) / currentDeck.length) * 100}%`;
            updateIntervalDisplay();
        }

        function flipCard() {
            isFlipped = !isFlipped;
            document.getElementById('card').classList.toggle('flipped', isFlipped);
            if (isFlipped && studyMode === 'review') {
                document.getElementById('difficultyButtons').classList.add('visible');
                document.getElementById('controls').classList.add('hidden');
                document.getElementById('instructions').classList.add('hidden');
            }
        }

        function nextCard() {
            if (currentDeck.length === 0) return;
            currentIndex = (currentIndex + 1) % currentDeck.length;
            isFlipped = false;
            document.getElementById('card').classList.remove('flipped');
            document.getElementById('difficultyButtons').classList.remove('visible');
            document.getElementById('controls').classList.remove('hidden');
            document.getElementById('instructions').classList.remove('hidden');
            renderCard();
        }

        function prevCard() {
            if (currentDeck.length === 0) return;
            currentIndex = (currentIndex - 1 + currentDeck.length) % currentDeck.length;
            isFlipped = false;
            document.getElementById('card').classList.remove('flipped');
            document.getElementById('difficultyButtons').classList.remove('visible');
            document.getElementById('controls').classList.remove('hidden');
            document.getElementById('instructions').classList.remove('hidden');
            renderCard();
        }

        function resetProgress() {
            if (confirm('Reset all progress for this deck?')) {
                delete cardData[currentDeckKey];
                saveCardData();
                loadDeck(currentDeckKey);
            }
        }

        // Event listeners
        document.getElementById('card').addEventListener('click', flipCard);
        document.getElementById('prevBtn').addEventListener('click', prevCard);
        document.getElementById('nextBtn').addEventListener('click', nextCard);
        document.getElementById('deckSelector').addEventListener('change', (e) => loadDeck(e.target.value));

        // Touch handling
        let touchStartX = 0;
        document.getElementById('card').addEventListener('touchstart', (e) => { touchStartX = e.changedTouches[0].screenX; }, { passive: true });
        document.getElementById('card').addEventListener('touchend', (e) => {
            const diff = touchStartX - e.changedTouches[0].screenX;
            if (Math.abs(diff) > 50) diff > 0 ? nextCard() : prevCard();
        }, { passive: true });

        // Keyboard navigation
        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowLeft') prevCard();
            if (e.key === 'ArrowRight') nextCard();
            if (e.key === ' ' || e.key === 'Enter') { e.preventDefault(); flipCard(); }
        });

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            loadCardData();
            document.getElementById('loading').style.display = 'none';
            document.getElementById('header').style.display = 'block';
            loadDeck('sql-data-engineering');
        });
    </script>
</body>
</html>